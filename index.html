<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>flatcafe LIVE</title>
<style>
body {
  background:#111;
  color:#fff;
  font-family:sans-serif;
}
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
}
.card {
  position:relative;
  background:#222;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  transition:.3s;
}
.card img {
  width:100%;
  height:140px;
  object-fit:cover;
  filter:grayscale(1) brightness(.4);
}
.card .name {
  padding:8px;
  text-align:center;
}
.card.live img {
  filter:none;
}
.card.live {
  box-shadow:0 0 12px red;
}
.live-badge {
  position:absolute;
  top:8px;
  left:8px;
  background:red;
  color:white;
  padding:2px 6px;
  font-size:12px;
  border-radius:6px;
  display:none;
}
.card.live .live-badge {
  display:block;
}
</style>
</head>
<body>

<h2>☕ flatcafe LIVE</h2>
<div class="grid" id="grid"></div>

<script>
const YOUTUBE_API_KEY = "AIzaSyA6e6pIM3e85U_S6Hu3gIpxwsx0_E37vIE";

const members = [
  { name:'若凪', type:'twitch', channel:'wakanagi', url:'https://www.twitch.tv/wakanagi', img:'https://static-cdn.jtvnw.net/jtv_user_pictures/wakanagi-profile_image-300x300.png' },
  { name:'柚茶', type:'twitch', channel:'yuzucha08', url:'https://www.twitch.tv/yuzucha08', img:'https://static-cdn.jtvnw.net/jtv_user_pictures/yuzucha08-profile_image-300x300.png' },
  { name:'Lily00', type:'twitch', channel:'lily00_flca', url:'https://www.twitch.tv/lily00_flca', img:'https://static-cdn.jtvnw.net/jtv_user_pictures/lily00_flca-profile_image-300x300.png' },
  { name:'とるま', type:'twitch', channel:'tourma_flca', url:'https://www.twitch.tv/tourma_flca', img:'https://static-cdn.jtvnw.net/jtv_user_pictures/tourma_flca-profile_image-300x300.png' },
  { name:'ふらcafe YouTube', type:'youtube', channelId:'UCAsCx41YE4mEIBCIAGOzFfA', url:'https://www.youtube.com/@flatcafe_games/live', img:'https://yt3.ggpht.com/ytc/UCAsCx41YE4mEIBCIAGOzFfA=s300-c-k-c0x00ffffff-no-rj' }
];

const grid = document.getElementById("grid");

members.forEach((m,i)=>{
  const d = document.createElement("div");
  d.className="card";
  d.id="card"+i;
  d.innerHTML = `
    <div class="live-badge">LIVE</div>
    <img src="${m.img}">
    <div class="name">${m.name}</div>
  `;
  d.onclick=()=>window.open(m.url,"_blank");
  grid.appendChild(d);
  check(m,i);
});

function check(m,i){
  const card=document.getElementById("card"+i);
  const img=card.querySelector("img");

  if(m.type==="twitch"){
    fetch(`https://decapi.me/twitch/uptime/${m.channel}`)
      .then(r=>r.text())
      .then(t=>{
        if(!t.includes("offline")){
          card.classList.add("live");
          img.src=`https://static-cdn.jtvnw.net/previews-ttv/live_user_${m.channel}-640x360.jpg?${Date.now()}`;
        } else {
          card.classList.remove("live");
        }
      });
  }

  if(m.type==="youtube"){
    fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${m.channelId}&eventType=live&type=video&key=${YOUTUBE_API_KEY}`)
      .then(r=>r.json())
      .then(d=>{
        if(d.items && d.items.length){
          card.classList.add("live");
          img.src=d.items[0].snippet.thumbnails.high.url;
          card.onclick=()=>window.open(`https://www.youtube.com/watch?v=${d.items[0].id.videoId}`,"_blank");
        } else {
          card.classList.remove("live");
        }
      });
  }
}

setInterval(()=>members.forEach(check),60000);
</script>
</body>
</html>
